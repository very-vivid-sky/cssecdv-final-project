{{>guestheader}}

<body class="d-flex flex-column min-vh-100">
  <section class="container column my-3">
    <div>
      <h1>Reset Password</h1>
    </div>
    
    {{#if message_success}}
    <div class="row alert alert-success" role="alert">{{message_success}}</div>
    {{/if}}
    {{#if message_warning}}
    <div class="row alert alert-danger" role="alert"><strong>{{message_warning}}</strong></div>
    {{/if}}

    <div class="my-2 mx-3">

      {{#if (eq step "identify")}}
        <p class="text-muted">Enter your email address and we'll show you security questions to verify your identity.</p>
        <!-- Step 1: Enter email -->
        <form method="POST" action="/resetpassword" class="form vstack login-form gap-2">
          <input type="hidden" name="step" value="identify">
          <input type="email" name="email" placeholder="Email" class="form-control" required autofocus>
          
          <button type="submit" class="btn btn-primary mt-2">Continue</button>
        </form>
        
        <div class="mt-3">
          <a href="/login">Back to login</a>
        </div>

      {{else if (eq step "verify")}}
        <!-- Step 2: Answer security questions and set new password -->
        <p class="text-muted">Answer your security questions to reset your password.</p>

        <form method="POST" action="/resetpassword" class="form vstack login-form d-flex flex-column gap-2">
          <input type="hidden" name="step" value="verify">
          <input type="hidden" name="email" value="{{email}}">
          <input type="hidden" name="question1" value="{{securityQuestion1}}">
          <input type="hidden" name="question2" value="{{securityQuestion2}}">
          
          <div class="d-flex flex-column gap-1">
            <label class="form-label"><strong>{{securityQuestion1}}</strong></label>
            <input type="text" name="answer1" placeholder="Your answer" class="form-control" required>
          </div>
          
          <div class="d-flex flex-column gap-1">
            <label class="form-label"><strong>{{securityQuestion2}}</strong></label>
            <input type="text" name="answer2" placeholder="Your answer" class="form-control" required>
          </div>
          
          <div class="d-flex flex-column gap-1">
            <label class="form-label"><strong>Enter your new password:</strong></label>
            <input type="password" name="newPassword" placeholder="New password" class="form-control" required>
            <input type="password" name="confirmPassword" placeholder="Retype password" class="form-control" required>
          </div>

          <button type="submit" class="btn btn-primary mt-2">Reset Password</button>
        </form>
        
        <div class="mt-3">
          <a href="/resetpassword">Start Over</a>
        </div>

      {{else if (eq step "success")}}
        <!-- Step 3: Success message -->
        <div class="alert alert-success" role="alert">
          <h4 class="alert-heading">Password Reset Successful!</h4>
          <p>Your password has been successfully reset. You can now log in with your new password.</p>
          <hr>
          <p class="mb-0"><a href="/login" class="btn btn-success">Go to Login</a></p>
        </div>

      {{/if}}

    </div>
  </section>
</body>